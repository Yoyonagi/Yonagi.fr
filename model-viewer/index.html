<!DOCTYPE html>
<html lang="fr">
<head>
    <script>
        // Meta spécifiques à la page Model Viewer
        window.PAGE = {
            title: "Visualiseur 3D — Yonagi",
            desc: "Explore mes modèles 3D directement dans le navigateur : rotation, zoom, AR et switch entre plusieurs scènes.",
            path: "/model-viewer/"
        };

        // Injecte le head commun
        (async () => {
            const res = await fetch('/assets/html/head-meta.html');
            let html = await res.text();
            const P = window.PAGE || {};
            html = html
                .replaceAll('<!--PAGE_TITLE-->', P.title || 'Yonagi — Site')
                .replaceAll('<!--PAGE_DESC-->', P.desc || 'Portfolio et projets de Yonagi.')
                .replaceAll('<!--PAGE_PATH-->', P.path || '/');
            document.head.insertAdjacentHTML('afterbegin', html);
        })();
    </script>

    <!-- model-viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
</head>

<body class="with-sidebar">
    <!-- Sidebar -->
    <div id="sidebar"></div>
    <script src="/assets/js/sidebar-loader.js" defer></script>

    <main class="container hero">
        <header>
            <div>
                <h1 class="viewer-title">Visualisation 3D</h1>
                <p class="muted">Rotation • Zoom • AR (sur mobile compatible)</p>
            </div>
        </header>

        <!-- Switcher -->
        <div class="model-switcher" id="switcher">
            <!-- Mets les bons chemins si tu as des sous-dossiers: /assets/3d/<sous-dossier>/<fichier>.glb -->
            <button data-src="/assets/3d/Technivibe.glb" data-title="Technivibe" aria-current="true">Technivibe</button>
            <button data-src="/assets/3d/Injection.glb" data-title="Injection">Injection</button>
            <button data-src="/assets/3d/Moule-projet.glb" data-title="Moule (projet)">Moule (projet)</button>
            <button data-src="/assets/3d/Machine-a-cookies.glb" data-title="Machine à cookies">Machine à cookies</button>
        </div>
        <p class="hint">Tip: clique un bouton pour changer de modèle</p>

        <!-- Viewer -->
        <section class="viewer-container">
            <div class="viewer-box">
                <model-viewer id="viewer"
                              src="/assets/3d/Technivibe.glb"
                              alt="Visualiseur 3D"
                              ar
                              auto-rotate
                              camera-controls
                              touch-action="pan-y"
                              shadow-intensity="1"
                              exposure="1">
                </model-viewer>
            </div>
        </section>

        <a class="back" href="/">⬅ Retour à l’accueil</a>
    </main>

    <!-- Footer -->
    <div id="footer"></div>
    <script src="/assets/js/footer-loader.js" defer></script>

    <!-- Script: switch dynamique -->
    <script>
        (function () {
            const viewer = document.getElementById('viewer');
            const buttons = Array.from(document.querySelectorAll('#switcher button'));
            const titleEl = document.querySelector('.viewer-title');

            function setActive(btn) {
                buttons.forEach(b => b.removeAttribute('aria-current'));
                btn.setAttribute('aria-current', 'true');
            }

            buttons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const src = btn.getAttribute('data-src');
                    const title = btn.getAttribute('data-title') || 'Visualisation 3D';
                    if (src) {
                        viewer.setAttribute('src', src);
                        titleEl.textContent = `Visualisation 3D : ${title}`;
                        setActive(btn);
                    }
                });
            });
        })();
    </script>
</body>
</html>
